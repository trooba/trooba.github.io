<!doctype html><html><head><title>Pipeline Lifecycle | Trooba</title><link rel="icon" type="image/png" sizes="32x21" href="/favicon-21709fb7.png"><meta name="viewport" content="width=device-width, initial-scale=1"><script>
        var scalingBodyFont = false;

        function scaleBodyFont() {
            var height = Math.max(window.outerHeight, window.screen.height);
            document.documentElement.style.fontSize = Math.pow(Math.min(window.innerWidth, height), 0.25)*19+'%';
            scalingBodyFont = false;
        }

        window.addEventListener('resize', function() {
            requestAnimationFrame(scaleBodyFont);
        });

        scaleBodyFont();
    </script><link rel="stylesheet" href="/docs-840cda31.css"></head><body class="docs"><header class="site-header" id="s0"><a href="/"><img src="/logo-header-3015f806.png" class="site-logo"></a><div class="stuff"><nav class="site-menu"><a href="/docs/introduction-overview/">Getting started</a><a href="/docs/trooba-book-overview/">Book</a><a href="https://github.com/trooba/trooba">github</a><form class="site-search search" id="s0-c0" data-marko='{"onclick":"focus s0-c0","onsubmit":"search s0-c0"}'><img src="/search-c29a7d7d.png"><input type="search" placeholder="search the docs..." id="s0-c0-input"></form></nav><button class="menu" data-marko='{"onclick":"emit s0 0"}'>&#9776;</button></div></header><div class="doc-sidebar" id="s1-sidebar"><button class="close" data-marko='{"onclick":"hide s1"}'>&#10005;</button><h1>Trooba <select id="s1-c0" data-marko='{"onchange":"switchVersion s1-c0"}'><option value="current" selected>2.0.2</option></select></h1><form class="site-search search" id="s1-c1" data-marko='{"onclick":"focus s1-c1","onsubmit":"search s1-c1"}'><img src="/search-c29a7d7d.png"><input type="search" placeholder="search the docs..." id="s1-c1-input"></form><ul class="toc-level0"><li class="section"><a href="/docs/introduction-overview/">INTRODUCTION</a></li><li><a href="/docs/installing/">Installing</a></li><li><a href="/docs/getting-started/">Getting Started</a></li><li><a href="/docs/api/">API</a></li><li><a href="/docs/handlers/">Handlers</a></li><li><a href="/docs/transports/">Transports</a></li><li><a href="/docs/custom-api/">Custom API</a></li><li><a href="/docs/streaming/">Streaming</a></li><li><a href="/docs/tracing/">Tracing</a></li><li><a href="/docs/enforcing-delivery/">Enforcing Delivery</a></li></ul><ul class="toc-level0"><li class="section"><a href="/docs/trooba-book-overview/">TROOBA BOOK</a></li><li><a href="/docs/scalable-pipelines/">Scalable Pipelines</a></li><li><a href="/docs/ideal-framework/">Ideal Framework</a></li><li><a href="/docs/separation-of-concerns/">Separation Of Concerns</a></li><li><a href="/docs/using-trooba/">Using Trooba</a></li><li><a href="/docs/bootstrapping-from-config/">Bootstrapping From Config</a></li><li><a href="/docs/pipelines-everywhere/">Pipelines Everywhere!</a></li><li><a class="selected" href="/docs/pipeline-lifecycle/">Pipeline Lifecycle</a><ul class="toc toc-level1"><li><a href="#the-service-invocation-lifecycle">The service invocation lifecycle</a></li><li><a href="#the-service-endpoint-lifecycle">The service endpoint lifecycle</a></li></ul></li><li><a href="/docs/transport-with-context/">Transport With Context</a></li></ul></div><div class="content"><div class="doc-layout"><div class="doc-container"><div class="doc-content"><h1 id="pipeline-lifecycle"><a name="pipeline-lifecycle" class="anchor" href="#pipeline-lifecycle"><span class="header-link"></span></a>Pipeline Lifecycle</h1><p>Here we will explore two main use cases where pipelines are used: service and client. Based on the type of the pipeline, the lifecycles can be different.</p><p>Other use-cases are possible like pub/sub with one way transmission or transformer pipeline that have no service flow and simply used to transform the data.</p><p>The differences are defined by transport, its position in the pipeline (at the start or end of the pipe) and execution order of handlers.</p><h2 id="the-service-invocation-lifecycle"><a name="the-service-invocation-lifecycle" class="anchor" href="#the-service-invocation-lifecycle"><span class="header-link"></span></a>The service invocation lifecycle</h2><p>The service invocation is always initiated by application code which is already running in the specific context that can be injected into the pipeline context to make sure the context is propagated to the downstream services.</p><ul><li>Pipe construction<ul><li>Transport or some other handler can inject custom API that one then use after construction</li></ul></li><li>Execution<ul><li>Context injection</li><li>Request phase<ul><li>Initialization phase<ul><li>Request hook: wait for request event</li><li>Response hook, wait for response event</li><li>Error hook: wait for error event</li></ul></li><li>Execution phase<ul><li>On request event</li><li>Continue or throw error</li></ul></li></ul></li><li>Transport phase<ul><li>Initialization phase<ul><li>Request hook</li></ul></li><li>Execution phase<ul><li>On request event</li><li>Response initiation or throw error</li></ul></li></ul></li><li>Response phase (optional in pub/sub use-case)<ul><li>Pipe handler execution in reverse order<ul><li>Hook: on response event</li><li>Hook: on error event - continue or retry</li></ul></li></ul></li><li>Completion<ul><li>Should be marked by either response or some other event in case of streams (data === undefined)</li></ul></li></ul></li></ul><h2 id="the-service-endpoint-lifecycle"><a name="the-service-endpoint-lifecycle" class="anchor" href="#the-service-endpoint-lifecycle"><span class="header-link"></span></a>The service endpoint lifecycle</h2><p>The service endpoint is any http/soap/grpc/websocket/etc service that accepts requests from the external world and executes some logic based on request type, path and other request parameters. The most popular one is express or hapi frameworks that provide this type of functionality.</p><ul><li>Pipe construction<ul><li>Transport initialization</li><li>Service API injection, generic API (listen, close)</li></ul></li><li>Application creation, using service API<ul><li>Execution<ul><li>Request phase<ul><li>Route selection</li><li>Pipe construction based on route, unless already created</li><li>Pipe context injection</li><li>Pipe execution for given request</li></ul></li></ul></li><li>Shutdown phase<ul><li>Graceful</li><li>Forced termination</li></ul></li><li>Closed</li></ul></li></ul><p>The main cycle will always start from the client code initiating the call with injected context for service calls or an external request coming to the service from the outside world.</p><p>The request phase (direction) will always be present, while response phase is optional in case of pub/sub use-case.</p><p>Request and response phases can be repeated partially in case a specific handlers, for example, ‘retry’ handler decides to do so based on the error received from the last response.</p><p>The framework does not allow registering more than one hook for every type of the event in the same pipe point/handler. We would like to avoid splitting the flow that may be caused by multiple listeners hooking the the same event in the same pipe point. This simplifies the flow. In case it detects existing hook, it will throw Error.</p><a href="https://github.com/trooba/trooba-book/blob/master/book/pipeline-lifecycle.md" class="edit-on-github">EDIT <img src="/github-02f398dc.svg"></a><h2 id="contributors"><a name="contributors" class="anchor" href="#contributors"><span class="header-link"></span></a> Contributors</h2><p>Helpful? You can thank these awesome people! You can also <a href="https://github.com/trooba/trooba/blob/master/docs/pipeline-lifecycle.md">edit this doc</a> if you see any issues or want to improve it.</p><div class="contributors"><a href="https://github.com/trooba/trooba/blob/master/docs/pipeline-lifecycle.md" class="contributor you"><div class="photo"><span class="icon">+</span></div><span class="name">You?</span></a></div><script>(function(){var w=window;w.$components=(w.$components||[]).concat({"w":[["s0-c0",1,{"class":"search"},{"d":[["blur","shrink","s0-c0-input",null],["focus","grow","s0-c0-input",null]]}],["s0",0,{},{"b":[["toggle-menu"]]}],["s1-c0",3,{},{}],["s1-c1",1,{"class":"search"},{"d":[["blur","shrink","s1-c1-input",null],["focus","grow","s1-c1-input",null]]}],["s1",2,{"doc":"pipeline-lifecycle","toc":"<ul class=\"toc toc-level1\"><li><a href=\"#the-service-invocation-lifecycle\">The service invocation lifecycle\u003C/a>\u003C/li><li><a href=\"#the-service-endpoint-lifecycle\">The service endpoint lifecycle\u003C/a>\u003C/li>\u003C/ul>"},{"r":["sidebar"]}]],"t":["/trooba-website$1.0.0/components/site-header/component-browser","/trooba-website$1.0.0/components/site-search/component-browser","/trooba-website$1.0.0/components/doc-sidebar/component-browser","/trooba-website$1.0.0/components/doc-sidebar/components/version-switcher/component-browser"]})||w.$components})()</script><footer class="site-footer doc-footer"><span><img src="/ebay-e69eedab.svg"> open source</span><div class="copyright">Copyright &copy; 2017 eBay Inc. &mdash; <a href="https://github.com/trooba/trooba/blob/master/LICENSE">The MIT License</a></div></footer></div></div></div></div><script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-103058606-1', 'trooba.github.io');
ga('send', 'pageview');
</script><script>
    ((window.gitter = {}).chat = {}).options = {
      room: 'trooba/general'
    };
    </script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script><script src="/docs-1c73820e.js"></script>
<script>$_mod.ready();</script></body></html>