<!doctype html><html><head><title>Pipelines Everywhere! | Trooba</title><link rel="icon" type="image/png" sizes="32x21" href="/favicon-21709fb7.png"><meta name="viewport" content="width=device-width, initial-scale=1"><script>
        var scalingBodyFont = false;

        function scaleBodyFont() {
            var height = Math.max(window.outerHeight, window.screen.height);
            document.documentElement.style.fontSize = Math.pow(Math.min(window.innerWidth, height), 0.25)*19+'%';
            scalingBodyFont = false;
        }

        window.addEventListener('resize', function() {
            requestAnimationFrame(scaleBodyFont);
        });

        scaleBodyFont();
    </script><link rel="stylesheet" href="/docs-840cda31.css"></head><body class="docs"><header class="site-header" id="s0"><a href="/"><img src="/logo-header-3015f806.png" class="site-logo"></a><div class="stuff"><nav class="site-menu"><a href="/docs/introduction-overview/">Getting started</a><a href="/docs/trooba-book-overview/">Book</a><a href="https://github.com/trooba/trooba">github</a><form class="site-search search" id="s0-c0" data-marko='{"onclick":"focus s0-c0","onsubmit":"search s0-c0"}'><img src="/search-c29a7d7d.png"><input type="search" placeholder="search the docs..." id="s0-c0-input"></form></nav><button class="menu" data-marko='{"onclick":"emit s0 0"}'>&#9776;</button></div></header><div class="doc-sidebar" id="s1-sidebar"><button class="close" data-marko='{"onclick":"hide s1"}'>&#10005;</button><h1>Trooba <select id="s1-c0" data-marko='{"onchange":"switchVersion s1-c0"}'><option value="current" selected>2.0.2</option></select></h1><form class="site-search search" id="s1-c1" data-marko='{"onclick":"focus s1-c1","onsubmit":"search s1-c1"}'><img src="/search-c29a7d7d.png"><input type="search" placeholder="search the docs..." id="s1-c1-input"></form><ul class="toc-level0"><li class="section"><a href="/docs/introduction-overview/">INTRODUCTION</a></li><li><a href="/docs/installing/">Installing</a></li><li><a href="/docs/getting-started/">Getting Started</a></li><li><a href="/docs/api/">API</a></li><li><a href="/docs/handlers/">Handlers</a></li><li><a href="/docs/transports/">Transports</a></li><li><a href="/docs/custom-api/">Custom API</a></li><li><a href="/docs/streaming/">Streaming</a></li><li><a href="/docs/tracing/">Tracing</a></li><li><a href="/docs/enforcing-delivery/">Enforcing Delivery</a></li></ul><ul class="toc-level0"><li class="section"><a href="/docs/trooba-book-overview/">TROOBA BOOK</a></li><li><a href="/docs/scalable-pipelines/">Scalable Pipelines</a></li><li><a href="/docs/ideal-framework/">Ideal Framework</a></li><li><a href="/docs/separation-of-concerns/">Separation Of Concerns</a></li><li><a href="/docs/using-trooba/">Using Trooba</a></li><li><a href="/docs/bootstrapping-from-config/">Bootstrapping From Config</a></li><li><a class="selected" href="/docs/pipelines-everywhere/">Pipelines Everywhere!</a></li><li><a href="/docs/pipeline-lifecycle/">Pipeline Lifecycle</a></li><li><a href="/docs/transport-with-context/">Transport With Context</a></li></ul></div><div class="content"><div class="doc-layout"><div class="doc-container"><div class="doc-content"><h1 id="pipelines-everywhere"><a name="pipelines-everywhere" class="anchor" href="#pipelines-everywhere"><span class="header-link"></span></a>Pipelines Everywhere!</h1><p>Our pipeline framework turned out to be very generic, so it may be not a crazy idea now to look back and apply our pipeline on the incoming traffic instead of express middleware pipeline.</p><p><img src="/pipes-everywhere-7c594aee.png" alt="pipes everywhere" width=871 height=538></p><p>Now our application seems like a chain of pipelines connected to each other through transports or controllers that are merely a different type of pipe, a traffic splitter and transformer that directs traffic to other pipelines based on route or other runtime properties and collector.</p><p>When it is generic, it is easy to apply uniform approach designing them and spot any gaps or missing parts.</p><p>For example, note that the service invocation pipeline has a circuit breaker while the incoming traffic pipeline does not. Why?</p><p>According to Wiki: “Circuit breaker is used to detect failures and encapsulates logic of preventing a failure to reoccur constantly (during maintenance, temporary external system failure or unexpected system difficulties)”</p><p>Circuit Breaker pattern was popularized by Netlfix through Hystrix component in java world and now is expanding to other programing languages.</p><p>Why not use it on incoming traffic? What are the potential use-cases?</p><p>The most obvious use-case is to increase the resiliency of the system by monitoring server instance state and notifying the clients right away about any problems before it starts affecting the system and in case when the system is too busy (CPU &gt;95%), we can offload incoming traffic to other clusters/datacenters or let the clients know by sending 503 response.</p><p>It is always good to prevent overwhelming of the system by too much traffic sooner than later. There are various causes for this situation. It can be due to DDoS attack or when traffic is diverted from other data center without regard to the capacity of the target data center and things like that.</p><p>The updated diagram now looks like this:</p><p><img src="/pipes-with-cb-6115912e.png" alt="incoming traffic pipeline" width=873 height=539></p><p>If we analyze it now, we can see that the circuit breaker in the service invocation pipeline acts on assumption that the downstream service is in a bad state or under pressure and short circuiting we give some time for the service to recover, this is still an assumption.</p><p>The circuit breaker on the incoming pipeline entirely belongs to the application and is aware of the application state. This allows the circuit breaker to generate more valid responses when the system gets under pressure and needs to shed some traffic. For example, if the circuit breaker was not there and the system got too busy, that would slow down handling the incoming requests and some of the calls would inevitably timeout out. This is not optimal outcome as the client application would waste their time waiting for response and get unknown state for the resources that were accessed. With the circuit breaker the application can quickly respond with 503 status code giving a clear state to the client that non of the resources have been affected and the client can safely re-try the service call.</p><p>For more details on how to implement this you might want to check out <a href="https://codeburst.io/building-resilient-platform-part-1-51b852588fb3">this blog post</a> and <a href="https://codeburst.io/building-resilient-platform-part-2-509c9550617d">this</a></p><p>Now if we fly really high and look at our pipelines, we could see something like this:</p><p><img src="/pipe-high-level-0fb931f5.png" alt="high level view" width=793 height=210></p><p>As you may notice, the transports connect pipes of separate instances of our distributed application while the controllers connects pipes within a single application instance.</p><p>This also can give us some ideas on how to proceed further designing our pipeline based systems. If a transport is replaceable and the controller is a kind of the transport, then we can try to replace applications as any other transports. The transports and controllers are the only &quot;handlers&quot; that have specifics of the protocol/application. The rest are generic and can be moved outside of the application. </p><p><img src="/pipe-high-level-updated-84c66d74.png" alt="high level view modified" width=790 height=336></p><a href="https://github.com/trooba/trooba-book/blob/master/book/pipelines-everywhere.md" class="edit-on-github">EDIT <img src="/github-02f398dc.svg"></a><h2 id="contributors"><a name="contributors" class="anchor" href="#contributors"><span class="header-link"></span></a> Contributors</h2><p>Helpful? You can thank these awesome people! You can also <a href="https://github.com/trooba/trooba/blob/master/docs/pipelines-everywhere.md">edit this doc</a> if you see any issues or want to improve it.</p><div class="contributors"><a href="https://github.com/trooba/trooba/blob/master/docs/pipelines-everywhere.md" class="contributor you"><div class="photo"><span class="icon">+</span></div><span class="name">You?</span></a></div><script>(function(){var w=window;w.$components=(w.$components||[]).concat({"w":[["s0-c0",1,{"class":"search"},{"d":[["blur","shrink","s0-c0-input",null],["focus","grow","s0-c0-input",null]]}],["s0",0,{},{"b":[["toggle-menu"]]}],["s1-c0",3,{},{}],["s1-c1",1,{"class":"search"},{"d":[["blur","shrink","s1-c1-input",null],["focus","grow","s1-c1-input",null]]}],["s1",2,{"doc":"pipelines-everywhere","toc":""},{"r":["sidebar"]}]],"t":["/trooba-website$1.0.0/components/site-header/component-browser","/trooba-website$1.0.0/components/site-search/component-browser","/trooba-website$1.0.0/components/doc-sidebar/component-browser","/trooba-website$1.0.0/components/doc-sidebar/components/version-switcher/component-browser"]})||w.$components})()</script><footer class="site-footer doc-footer"><span><img src="/ebay-e69eedab.svg"> open source</span><div class="copyright">Copyright &copy; 2017 eBay Inc. &mdash; <a href="https://github.com/trooba/trooba/blob/master/LICENSE">The MIT License</a></div></footer></div></div></div></div><script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-103058606-1', 'trooba.github.io');
ga('send', 'pageview');
</script><script>
    ((window.gitter = {}).chat = {}).options = {
      room: 'trooba/general'
    };
    </script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script><script src="/docs-1c73820e.js"></script>
<script>$_mod.ready();</script></body></html>