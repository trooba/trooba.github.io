<!doctype html><html><head><title>Trooba API | Trooba</title><link rel="icon" type="image/png" sizes="32x21" href="/favicon-21709fb7.png"><meta name="viewport" content="width=device-width, initial-scale=1"><script>
        var scalingBodyFont = false;

        function scaleBodyFont() {
            var height = Math.max(window.outerHeight, window.screen.height);
            document.documentElement.style.fontSize = Math.pow(Math.min(window.innerWidth, height), 0.25)*19+'%';
            scalingBodyFont = false;
        }

        window.addEventListener('resize', function() {
            requestAnimationFrame(scaleBodyFont);
        });

        scaleBodyFont();
    </script><link rel="stylesheet" href="/docs-c04ad79b.css"></head><body class="docs"><header class="site-header" id="s0"><a href="/"><img src="/logo-header-3015f806.png" class="site-logo"></a><div class="stuff"><nav class="site-menu"><a href="/docs/introduction-overview/">Getting started</a><a href="/docs/trooba-book-overview/">Book</a><a href="https://github.com/trooba/trooba">github</a><form class="site-search search" id="s0-c0" data-marko='{"onclick":"focus s0-c0","onsubmit":"search s0-c0"}'><img src="/search-c29a7d7d.png"><input type="search" placeholder="search the docs..." id="s0-c0-input"></form></nav><button class="menu" data-marko='{"onclick":"emit s0 0"}'>&#9776;</button></div></header><div class="doc-sidebar" id="s1-sidebar"><button class="close" data-marko='{"onclick":"hide s1"}'>&#10005;</button><h1>Trooba <select id="s1-c0" data-marko='{"onchange":"switchVersion s1-c0"}'><option value="current" selected>2.0.2</option></select></h1><form class="site-search search" id="s1-c1" data-marko='{"onclick":"focus s1-c1","onsubmit":"search s1-c1"}'><img src="/search-c29a7d7d.png"><input type="search" placeholder="search the docs..." id="s1-c1-input"></form><ul class="toc-level0"><li class="section"><a href="/docs/introduction-overview/">INTRODUCTION</a></li><li><a href="/docs/installing/">Installing</a></li><li><a href="/docs/getting-started/">Getting Started</a></li><li><a class="selected" href="/docs/api/">API</a><ul class="toc toc-level1"><li><ul class="toc toc-level2"><li><a href="#pipe-api">Pipe API</a><ul class="toc toc-level3"><li><a href="#message">Message</a></li></ul></li></ul></li></ul></li><li><a href="/docs/handlers/">Handlers</a></li><li><a href="/docs/transports/">Transports</a></li><li><a href="/docs/custom-api/">Custom API</a></li><li><a href="/docs/streaming/">Streaming</a></li><li><a href="/docs/tracing/">Tracing</a></li><li><a href="/docs/enforcing-delivery/">Enforcing Delivery</a></li></ul><ul class="toc-level0"><li class="section"><a href="/docs/trooba-book-overview/">TROOBA BOOK</a></li><li><a href="/docs/scalable-pipelines/">Scalable Pipelines</a></li><li><a href="/docs/ideal-framework/">Ideal Framework</a></li><li><a href="/docs/separation-of-concerns/">Separation Of Concerns</a></li><li><a href="/docs/using-trooba/">Using Trooba</a></li><li><a href="/docs/bootstrapping-from-config/">Bootstrapping From Config</a></li><li><a href="/docs/pipelines-everywhere/">Pipelines Everywhere!</a></li><li><a href="/docs/pipeline-lifecycle/">Pipeline Lifecycle</a></li><li><a href="/docs/transport-with-context/">Transport With Context</a></li></ul></div><div class="content"><div class="doc-layout"><div class="doc-container"><div class="doc-content"><h1 id="trooba-api"><a name="trooba-api" class="anchor" href="#trooba-api"><span class="header-link"></span></a>Trooba API</h1><ul><li><strong><code>use</code></strong><code>(handler[, config])</code> - adds a handler to the pipeline<ul><li><em><code>handler</code></em> - a <code>function handler(pipe) {}</code> or another pipe to join into this pipe.</li><li><em><code>config</code></em> is a config object for the handler</li></ul></li><li><strong><code>build</code></strong><code>([context])</code> - creates a pipe and returns a generic pipe object.</li><li><strong><code>set</code></strong><code>(name, value)</code> - used set system value to the context. The name is prefixed with &#39;&#36;&#39; that prevents it from being propagated beyond the current pipe context boundaries.</li><li><strong><code>get</code></strong><code>(name)</code> - is used to get system value from the context.</li></ul><h3 id="pipe-api"><a name="pipe-api" class="anchor" href="#pipe-api"><span class="header-link"></span></a>Pipe API</h3><p>The pipe object is passed to all handlers and transport during initialization whenever new context is created via trooba.build(context) or pipe.create(context) call.</p><ul><li><strong><code>create</code></strong><code>([context], [customApiImpl])</code> - creates a pipeline with new context or clones from the existing one if any present. The method is mandatory to initiate a new flow, otherwise the subsequent call will fail.<ul><li><strong><code>context</code></strong> is a context object to be used in request/message flow.</li><li><strong><code>customApiImpl</code></strong> is a name for a specific API implementation. It allows to inject custom API provided by one of the handlers that needs to be returned instead of the generic pipe interface.</li></ul></li><li><strong><code>context</code></strong> - is an object available to all handlers/transport in the same request/response flow. One can use it to store data that needs to be shared between handlers if needed. The values in the context that have their names started with &#39;&#36;&#39; will not be propagated beyond the pipe boundaries. To access context one can use pipe.context;</li><li><strong><code>link</code></strong><code>(pipe)</code> - links passed pipeline to the current one. The link between pipes exists as long as the context where they were linked exists. Once pipe.create is used, it will lose the link. The linking can be useful to join pipes on the fly, for example to bootstrap pipe from config file and inline it into existing pipeline where bootstrap handler is registered.<script>
            if(localStorage.getItem('markojs-website:syntax') === 'concise') {
                document.body.classList.add('concise');
            }
        </script><pre class="editor editor-colors"><div class="line"><span class="source js"><span class="variable other object js"><span>Trooba</span></span><span class="meta method-call js"><span class="meta delimiter method period js"><span>.</span></span><span class="entity name function js"><span>use</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="meta function js"><span class="storage type function js"><span>function</span></span><span>&nbsp;</span><span class="entity name function js"><span>bootstrapPipe</span></span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="variable parameter function js"><span>pipe</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta method-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;load&nbsp;all&nbsp;the&nbsp;handlers&nbsp;from&nbsp;some&nbsp;json&nbsp;or&nbsp;config&nbsp;file</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta method-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;</span><span class="storage type var js"><span>var</span></span><span>&nbsp;handlers&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta brace square js"><span>[</span><span>]</span></span><span class="punctuation terminator statement js"><span>;</span></span><span>&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;assume&nbsp;it&nbsp;is&nbsp;loaded&nbsp;as&nbsp;an&nbsp;array</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta method-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;build&nbsp;the&nbsp;pipe&nbsp;or&nbsp;load&nbsp;from&nbsp;cache</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta method-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;</span><span class="storage type var js"><span>var</span></span><span>&nbsp;bootstrappedPipe&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="variable other object js"><span>handlers</span></span><span class="meta method-call js"><span class="meta delimiter method period js"><span>.</span></span><span class="entity name function js"><span>reduce</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="meta function arrow js"><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="variable parameter function js"><span>trooba</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="variable parameter function js"><span>handler</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span><span>&nbsp;</span><span class="storage type function arrow js"><span>=&gt;</span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta method-call js"><span class="meta arguments js"><span class="meta method-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control js"><span>return</span></span><span>&nbsp;</span><span class="variable other object js"><span>trooba</span></span><span class="meta method-call js"><span class="meta delimiter method period js"><span>.</span></span><span class="entity name function js"><span>use</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span>handler</span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta method-call js"><span class="meta arguments js"><span class="meta method-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;</span><span class="punctuation definition function body end bracket curly js"><span>}</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;Trooba</span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span><span class="meta delimiter method period js"><span>.</span></span><span class="entity name function js"><span>build</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta method-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;link&nbsp;it</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta method-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;</span><span class="variable other object js"><span>pipe</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="support variable property dom js"><span>link</span></span><span class="meta brace round js"><span>(</span></span><span>bootstrappedPipe</span><span class="meta brace round js"><span>)</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta method-call js"><span class="meta arguments js"><span class="punctuation definition function body end bracket curly js"><span>}</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div></pre></li><li><strong><code>request</code></strong><code>(requestObject)</code> - creates and sends an arbitrary request down the pipeline. If context was not used, it will implicitly call <em>create</em> method</li><li><strong><code>respond</code></strong><code>(responseObject)</code> initiates a response flow and sends an arbitrary response object down the response pipeline. This can be called only after the request flow is initiated.</li><li><strong><code>resume</code></strong><code>()</code> - resumes the processing in the given pipe point in ordered flow whenever the current message/response/request flow was paused due to processing of the ordered message and it was suppressed/swallowed, i.e. no throw/response/request/next action followed.</li><li><strong><code>streamRequest</code></strong><code>(requestObject)</code> - creates and sends an arbitrary request down the pipeline. If context was not used. It returns write stream with methods:<ul><li><strong><code>write(data)</code></strong> - write a chunk to the stream as &quot;request:data&quot; message</li><li><strong><code>end()</code></strong> - ends the stream and send &quot;request:end&quot; message</li></ul></li><li><strong><code>streamResponse</code></strong><code>(responseObject)</code> - initiates a response stream flow and sends an arbitrary response object down the response pipeline. This can be called only after the request flow is initiated. It returns write stream with methods:<ul><li><strong><code>write(data)</code></strong> - write a chunk to the stream as &quot;response:data&quot; message</li><li><strong><code>end()</code></strong> - ends the stream and send &quot;response:end&quot; message</li></ul></li><li><strong><code>send</code></strong><code>(message)</code> - sends a message down the request or response flow depending on the message type. For more details see message structure below. The method can be used to send a custom message.</li><li><strong><code>throw</code></strong><code>(Error)</code> sends the error down the response pipeline. If no error hooks defined in the pipeline, it will throw error. The method can be called only after the response flow is initiated.</li><li><strong><code>trace</code></strong><code>([Function callback(err, listOfPoints)])</code> - used to trace the route that any message would travel, it uses <code>message.type = &#39;trace&#39;</code> and returns a list of point it traveled in request/response flow.</li><li><strong><code>set</code></strong><code>(name, value)</code> - sets arbitrary system key-value pair to the context which will not be explicitly propagated beyond transport boundaries as internally the name will be prefixed as &#36;name. It is used to provide custom API by handlers.</li><li><strong><code>get</code></strong><code>(name)</code> - reads system value from the context.</li></ul><h4 id="message"><a name="message" class="anchor" href="#message"><span class="header-link"></span></a>Message</h4><p>The framework defines a message bus to send and receive messages within the pipeline.</p><p>The current message structure:</p><ul><li><strong><code>type</code></strong> - a <code>String</code> that defines a message type which can be used in pipe.on() and .once()</li><li><strong><code>flow</code></strong> - a <code>Number</code> that defines flow type. It will define the direction of the message in the pipeline<ul><li><code>1</code> - request</li><li><code>2</code> - response</li></ul></li><li><strong><code>ref</code></strong> - a reference to the data being sent in the message</li><li><strong><code>sync</code></strong> - a <code>boolean</code>, if equals <code>true</code>, the message will be propagated to all pipe points at the same time, no callback is needed to control when to send it to the next handler in the pipeline.</li><li><strong><code>order</code></strong> - a <code>boolean</code> value that controls order, if set to true, the message will be queued at any pipe point if similar ordered message is already in process by the given point.</li><li>The rest of the fields will be assigned by the framework and should not be changed</li></ul><div class="code-block-filename">Example:</div><pre class="editor editor-colors"><div class="line"><span class="source js"><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string quoted double js"><span class="punctuation definition string begin js"><span>&quot;</span></span><span>type</span><span class="punctuation definition string end js"><span>&quot;</span></span></span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="string quoted double js"><span class="punctuation definition string begin js"><span>&quot;</span></span><span>error</span><span class="punctuation definition string end js"><span>&quot;</span></span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string quoted double js"><span class="punctuation definition string begin js"><span>&quot;</span></span><span>flow</span><span class="punctuation definition string end js"><span>&quot;</span></span></span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="constant numeric decimal js"><span>1</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string quoted double js"><span class="punctuation definition string begin js"><span>&quot;</span></span><span>ref</span><span class="punctuation definition string end js"><span>&quot;</span></span></span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="string quoted double js"><span class="punctuation definition string begin js"><span>&quot;</span></span><span>[Error:&nbsp;some&nbsp;error&nbsp;message]</span><span class="punctuation definition string end js"><span>&quot;</span></span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string quoted double js"><span class="punctuation definition string begin js"><span>&quot;</span></span><span>sync</span><span class="punctuation definition string end js"><span>&quot;</span></span></span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="constant language boolean true js"><span>true</span></span></span></div><div class="line"><span class="source js"><span class="meta brace curly js"><span>}</span></span></span></div></pre><p><strong>Note:</strong> Since Trooba framework is based on message propagation through the pipeline, it uses time-to-live (TTL) parameter to limit the time the message can travel through the pipeline. By default it uses Infinity for TTL, but you can configure it using config.ttl parameter.</p><p>When a message is expired, it will be dropped through console.log by default or you can intercept it by registering your own onDrop handler to the context</p><pre class="editor editor-colors"><div class="line"><span class="source js"><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;set&nbsp;TTL&nbsp;to&nbsp;2&nbsp;seconds</span></span></span></div><div class="line"><span class="source js"><span class="variable other object js"><span>pipe</span></span><span class="meta method-call js"><span class="meta delimiter method period js"><span>.</span></span><span class="entity name function js"><span>build</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="meta brace curly js"><span>{</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta method-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;&nbsp;&nbsp;ttl</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="constant numeric decimal js"><span>2000</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;msec</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta method-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta function json js"><span class="entity name function js"><span>onDrop</span></span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="storage type function js"><span>function</span></span><span>&nbsp;</span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="variable parameter function js"><span>message</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta method-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="entity name type object console js"><span>console</span></span><span class="meta method-call js"><span class="meta delimiter method period js"><span>.</span></span><span class="support function console js"><span>log</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>dropped&nbsp;message:</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;message</span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta method-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta method-call js"><span class="meta arguments js"><span class="meta brace curly js"><span>}</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span></span></div></pre><a href="https://github.com/trooba/trooba/blob/master/docs/api.md" class="edit-on-github">EDIT <img src="/github-02f398dc.svg"></a><h2 id="contributors"><a name="contributors" class="anchor" href="#contributors"><span class="header-link"></span></a> Contributors</h2><p>Helpful? You can thank these awesome people! You can also <a href="https://github.com/trooba/trooba/blob/master/docs/api.md">edit this doc</a> if you see any issues or want to improve it.</p><div class="contributors"><a href="https://github.com/trooba/trooba/blob/master/docs/api.md" class="contributor you"><div class="photo"><span class="icon">+</span></div><span class="name">You?</span></a></div><script>(function(){var w=window;w.$components=(w.$components||[]).concat({"w":[["s0-c0",1,{"class":"search"},{"d":[["blur","shrink","s0-c0-input",null],["focus","grow","s0-c0-input",null]]}],["s0",0,{},{"b":[["toggle-menu"]]}],["s1-c0",3,{},{}],["s1-c1",1,{"class":"search"},{"d":[["blur","shrink","s1-c1-input",null],["focus","grow","s1-c1-input",null]]}],["s1",2,{"doc":"api","toc":"<ul class=\"toc toc-level1\"><li><ul class=\"toc toc-level2\"><li><a href=\"#pipe-api\">Pipe API\u003C/a><ul class=\"toc toc-level3\"><li><a href=\"#message\">Message\u003C/a>\u003C/li>\u003C/ul>\u003C/li>\u003C/ul>\u003C/li>\u003C/ul>"},{"r":["sidebar"]}]],"t":["/trooba-website$1.0.0/components/site-header/component-browser","/trooba-website$1.0.0/components/site-search/component-browser","/trooba-website$1.0.0/components/doc-sidebar/component-browser","/trooba-website$1.0.0/components/doc-sidebar/components/version-switcher/component-browser"]})||w.$components})()</script><footer class="site-footer doc-footer"><span><img src="/ebay-e69eedab.svg"> open source</span><div class="copyright">Copyright &copy; 2017 eBay Inc. &mdash; <a href="https://github.com/trooba/trooba/blob/master/LICENSE">The MIT License</a></div></footer></div></div></div></div><script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-103058606-1', 'trooba.github.io');
ga('send', 'pageview');
</script><script>
    ((window.gitter = {}).chat = {}).options = {
      room: 'trooba/general'
    };
    </script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script><script src="/docs-1c73820e.js"></script>
<script>$_mod.ready();</script></body></html>